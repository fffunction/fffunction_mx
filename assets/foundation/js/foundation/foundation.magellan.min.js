(function(t,a,i,e){"use strict";Foundation.libs.magellan={name:"magellan",version:"4.0.0",settings:{activeClass:"active"},init:function(a,i,e){this.scope=a||this.scope;Foundation.inherit(this,"data_options");if(typeof i==="object"){t.extend(true,this.settings,i)}if(typeof i!="string"){if(!this.settings.init){this.fixed_magellan=t("[data-magellan-expedition]");this.set_threshold();this.last_destination=t("[data-magellan-destination]").last();this.events()}return this.settings.init}else{return this[i].call(this,e)}},events:function(){var i=this;t(this.scope).on("arrival.fndtn.magellan","[data-magellan-arrival]",function(a){var e=t(this),n=e.closest("[data-magellan-expedition]"),s=n.attr("data-magellan-active-class")||i.settings.activeClass;e.closest("[data-magellan-expedition]").find("[data-magellan-arrival]").not(e).removeClass(s);e.addClass(s)});this.fixed_magellan.on("update-position.fndtn.magellan",function(){var a=t(this)}).trigger("update-position");t(a).on("resize.fndtn.magellan",function(){this.fixed_magellan.trigger("update-position")}.bind(this)).on("scroll.fndtn.magellan",function(){var e=t(a).scrollTop();i.fixed_magellan.each(function(){var a=t(this);if(typeof a.data("magellan-top-offset")==="undefined"){a.data("magellan-top-offset",a.offset().top)}if(typeof a.data("magellan-fixed-position")==="undefined"){a.data("magellan-fixed-position",false)}var n=e+i.settings.threshold>a.data("magellan-top-offset");var s=a.attr("data-magellan-top-offset");if(a.data("magellan-fixed-position")!=n){a.data("magellan-fixed-position",n);if(n){a.css({position:"fixed",top:0})}else{a.css({position:"",top:""})}if(n&&typeof s!="undefined"&&s!=false){a.css({position:"fixed",top:s+"px"})}}})});if(this.last_destination.length>0){t(a).on("scroll.fndtn.magellan",function(e){var n=t(a).scrollTop(),s=n+t(a).height(),l=Math.ceil(i.last_destination.offset().top);t("[data-magellan-destination]").each(function(){var a=t(this),e=a.attr("data-magellan-destination"),o=a.offset().top-n;if(o<=i.settings.threshold){t("[data-magellan-arrival='"+e+"']").trigger("arrival")}if(s>=t(i.scope).height()&&l>n&&l<s){t("[data-magellan-arrival]").last().trigger("arrival")}})})}this.settings.init=true},set_threshold:function(){if(!this.settings.threshold){this.settings.threshold=this.fixed_magellan.length>0?this.outerHeight(this.fixed_magellan,true):0}},off:function(){t(this.scope).off(".fndtn.magellan")}}})(Foundation.zj,this,this.document);